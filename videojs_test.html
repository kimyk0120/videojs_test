<!DOCTYPE html>
<!--suppress ALL -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>video_js_test</title>
    <link href="node_modules/video.js/dist/video-js.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- video js 플러그인 : https://github.com/silvermine/videojs-quality-selector#readme   -->
    <link href="node_modules/@silvermine/videojs-quality-selector/dist/css/quality-selector.css" rel="stylesheet">
</head>
<body>
    <h1>VIDEO.JS TEST</h1>
    <div id="container">
        <video id='my_video' class='video-js vjs-big-play-centered vjs-fluid vjs-time-control vjs-default-skin'>
<!--            <source id='mp4' src="http://media.w3.org/2010/05/sintel/trailer.mp4" type='video/mp4' />-->
<!--            <source id='webm' src="http://media.w3.org/2010/05/sintel/trailer.webm" type='video/webm' />-->
<!--            <source id='ogv' src="http://media.w3.org/2010/05/sintel/trailer.ogv" type='video/ogg' />-->
            <track kind='captions' src='videojs_test.vtt' srclang='en' label='English' default/>
        </video>
    </div>
    <script src="node_modules/video.js/dist/video.min.js"></script>
    <script src="node_modules/@silvermine/videojs-quality-selector/dist/js/silvermine-videojs-quality-selector.min.js"></script>
<script type="text/javascript">


$(document).ready(function(){

    let options = {
        sources: [
            {
                type: 'video/mp4',
                src: 'http://media.w3.org/2010/05/sintel/trailer.mp4',
                label: '720P'
            },
            {
                type: 'video/mp4',
                src: 'http://media.w3.org/2010/05/sintel/trailer.mp4',
                label: '480P'
            }
        ],
        playbackRates: [.5, .75, 1, 1.25, 1.5],
        poster: "http://media.w3.org/2010/05/sintel/poster.png",
        controls: true,
        preload: "auto",
        width: 540,
        height: 320,
        controlBar: {
            playToggle: true,
            pictureInPictureToggle: true,
            remainingTimeDisplay: true,
            progressControl: true,
            qualitySelector: true,
        }
    };

    var myPlayer = videojs('my_video', options);

    console.log(myPlayer);

    myPlayer.one("loadedmetadata", onLoadedMetadata);

    function onLoadedMetadata() {
        console.log(myPlayer.duration()); // 비디오 총 시간
    }

    // current time get/set
    myPlayer.ready(function() {
        myPlayer.currentTime(0);  // set
        var whereYouAt = myPlayer.currentTime();  // get
        console.log(whereYouAt);

    });


    // var threshold = 4;
    // var thresholdReached = false;

    // duration, current time
    myPlayer.on('timeupdate', function () {

        // console.log(myPlayer.readyState());

        var lengthOfVideo = myPlayer.duration();
        var whereYouAt = myPlayer.currentTime();
        var remainTime = myPlayer.remainingTime();
        console.log("총시간 : " + lengthOfVideo, ", 현재 시간 : " + whereYouAt, ", 남은 시간 : " + remainTime);

        // if (myPlayer.currentTime() >= threshold && !thresholdReached) {
        //     thresholdReached = true;
        //     alert('Started');
        // }
    });

    // is Paused
    myPlayer.on("click", function(event){
        event.preventDefault();
        var isPaused = myPlayer.paused();
        if (isPaused){
            var whereYouAt = myPlayer.currentTime();
            console.log("현재 시청중인 시간 :  " + whereYouAt)
        }
        console.log(isPaused);
    });

    // var srtText = `1
    //               00:00:00,500 --> 00:00:02,000
    //               One caption
    //               2
    //               00:00:03,000 --> 00:00:05,000
    //               Another caption`;
    // var srtRegex = /(.*\n)?(\d\d:\d\d:\d\d),(\d\d\d --> \d\d:\d\d:\d\d),(\d\d\d)/g;
    // var vttText = 'WEBVTT\n\n' + srtText.replace(srtRegex, '$1$2.$3.$4');
    //
    // console.log(vttText);
    //
    // var vttBlob = new Blob([vttText], {type : 'text/vtt'});
    // var blobURL = URL.createObjectURL(vttBlob);
    // myPlayer.on('loadedmetadata', function() {
    //     console.log("$$");
    //     this.addRemoteTextTrack({
    //         src: blobURL,
    //         srclang: 'en',
    //         label: 'english',
    //         kind: 'subtitles',
    //     }, true);
    // });

    // var tracks = myPlayer.textTracks();
    // console.log(tracks);
    //
    // for (var i = 0; i < tracks.length; i++) {
    //     var track = tracks[i];
    //
    //     // Find the English captions track and mark it as "showing".
    //     if (track.kind === 'captions' && track.language === 'en') {
    //         track.mode = 'showing';
    //     }
    // }

    // 재생 속도 조절
    //attr = data-setup='{"playbackRates": [0.5, 1, 1.5, 2] }'


}); // end DOMReady


    
</script>
</body>
</html>